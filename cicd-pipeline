pipeline
{
agent any
stages
{
stage('checkout scm')
{
steps
{
git credentialsId: 'github-creds', url: 'https://github.com/sreedevops26/devops-cicd-project-nov-19.git'
}
}
stage('build docker image')
{
steps
{
withDockerRegistry(credentialsId: 'docker-reg-creds', url: 'https://index.docker.io/v1/') 
{
 sh 'docker build -t sreedevops26/nginx:1.0 .'
 sh 'docker push sreedevops26/nginx:1.0'
 sh 'docker rmi sreedevops26/nginx:1.0'
}
 
}
}
stage('remove docker container if alredy exists')
{
steps
{
sh 'docker rm -f test'
}
}
stage('create docker container using own image')
{
steps
{
withDockerRegistry(credentialsId: 'docker-reg-creds', url: 'https://index.docker.io/v1/') 
{
sh 'docker pull sreedevops26/nginx:1.0'
sh 'docker run -dti --name test -p 81:80 sreedevops26/nginx:1.0 /bin/bash'
}
}
}
}
}
